#!/bin/bash

title='

â–ˆâ–„â–„â–„â–„ â–ˆâ–ˆâ–ˆâ–ˆâ–„ â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–„  â–„  â–ˆ â–„â–ˆâ–ˆâ–ˆâ–„   â–ˆ    â–ˆ â–„â–„
â–ˆ  â–„â–€ â–ˆ   â–ˆ â–ˆ  â–ˆ  â–ˆ   â–ˆ â–ˆ   â–ˆ â–ˆâ–€   â–€  â–ˆ    â–ˆ   â–ˆ
â–ˆâ–€â–€â–Œ  â–ˆ   â–ˆ â–ˆ â–€ â–„ â–ˆ   â–ˆ â–ˆâ–ˆâ–€â–€â–ˆ â–ˆâ–ˆâ–„â–„    â–ˆ    â–ˆâ–€â–€â–€
â–ˆ  â–ˆ  â–€â–ˆâ–ˆâ–ˆâ–ˆ â–ˆ  â–„â–€ â–€â–ˆâ–ˆâ–ˆâ–ˆ â–ˆ   â–ˆ â–ˆâ–„   â–„â–€ â–ˆâ–ˆâ–ˆâ–„ â–ˆ
  â–ˆ         â–ˆâ–ˆâ–ˆ            â–ˆ  â–€â–ˆâ–ˆâ–ˆâ–€       â–€ â–ˆ
 â–€                        â–€                  â–€
'

bb8='â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡€â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡‡â €â ‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â£€â£¸â£€â£€â£€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ´â ¾â ¿â ¿â ¿â ›â ‹â â €â£ â£´â †â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£ â£„â£€â£€â£€â£€â£€â£¤â£¤â£´â ¶â ›â¢‹â£¡â£´â£¿â£·â£„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¤â£¬â£‰â£‰â£‰â£‰â¡Ÿâ£â €â €â ˆâ ™â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£§â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¼â£¿â£¿â£¿â£¿â£¿â£¿â¡€â ›â €â €â €â €â£¿â£¿â ‹â ‰â ™â¢¿â£¿â£¿â£§â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£„â¡€â €â£€â£´â£¿â£‡â €â €â €â£¸â£¿â£¿â¡¿â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£¤â¡´â Ÿâ ›â£â ¤â ‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ¿â ¿â ›â ›â£‰â£¡â ¤â ’â ‹â â¢€â£€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¤â ¬â£‰â£‰â£‰â£‰â£ â ¤â ¤â ¤â ´â ’â šâ ‰â â €â €â €â£¤â£¾â£¿â£¿â£¿â£¶â£„â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â£´â£¶â£¦â£¤â£¤â£¤â£¤â£¤â£¤â£¤â£¤â£´â£¶â£¶â£¦â¡€â €â ˆâ ™â¢¿â£¿â ‹â ›â£¿â£¿â£¦â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£°â£¿â ¿â ›â ‰â ‰â ‰â ‰â ‰â ›â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â£„â €â €â €â €â €â¢¿â£¿â£¿â£¿â£¦â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¼â Ÿâ â¢€â£ â£¤â£¤â£¤â£„â¡€â €â €â ˆâ »â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£¤â£€â €â €â €â ‰â ‰â ‰â â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â£¼â ƒâ €â£´â£¿â£¿â£¿â£¿â£¿â Ÿâ €â¢€â¡€â €â €â ™â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£¦â£¤â£€â£€â£€â£€â¡€â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â£¸â ‡â €â €â¢¹â£¿â£¿â£¿â£¿â£¿â£¤â£´â£¿â£¿â¡„â €â €â ¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â¢€â£¿â €â£¿â£¦â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£§â €â €â €â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡†â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â¢¸â¡‡â €â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â €â €â €â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ¿â Ÿâ ›â »â ¿â£¿â¡‡â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â¢¸â£§â €â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ¿â¢¿â£¿â¡¿â €â €â €â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ ‹â €â €â €â €â €â €â ˜â¡Ÿâ €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â ˆâ£¿â¡€â ¸â£¿â¡¿â¢¿â£¿â£¿â£¿â£¿â£¿â£„â €â ˆâ â €â €â¢€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ â €â €â €â£ â£¤â£¶â£¦â£„â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â¢¿â£§â €â ™â €â¢°â£¿â£¿â£¿â£¿â£¿â£¿â¡·â €â €â €â €â£¼â£¿â£¿â£¿â£¿â£¿â¡Ÿâ â €â €â£ â¡€â €â¢»â£¿â£¿â£¿â¡¿â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â ˜â£¿â£·â¡€â €â ˜â ›â ¿â ¿â ¿â ›â ‰â €â €â €â¢€â£¾â£¿â£¿â£¿â£¿â£¿â â €â €â¢€â£´â£¿â£·â£¤â£¼â£¿â£¿â£¿â£ â †â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â ˜â£¿â£¿â£¦â£„â¡€â €â €â €â €â €â €â£ â£´â£¿â£¿â£¿â£¿â£¿â£¿â¡â €â €â¢€â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ˜â¢¿â£¿â£¿â£¿â£·â£¶â£¶â£¶â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â €â €â €â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ‹â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â »â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡‡â €â €â ˜â ›â ›â£¹â£¿â£¿â£¿â£¿â Ÿâ â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ˆâ ™â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡‡â €â €â¢ â£¶â£¿â£¿â£¿â¡¿â Ÿâ â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ˆâ ›â »â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â €â €â ˆâ »â ¿â ›â ‰â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
  â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‰â ‰â ™â ›â ›â ›â ›â ›â â €â €â €â €â €â €â €â €â €â €â €â €'


mainloop=0

# Function to print banner
show_banner() {
    echo "$title"
    echo "$bb8"
}

det_release() {
    distro=$(lsb_release -i | cut -f2-)
}

# Main Functions
apt_update() {
    echo "ðŸ“¦ Running APT Repository update..."
    sudo apt update -y
    if [ $? -eq 0 ]; then
        echo "âœ… Updated repositories successfully on $distro."
    else
	echo "âŒ Failed to update repositories on $distro. Exit code: $?"
    fi
}

apt_upgrade() {
    echo "ðŸ“¦ Upgrading installed packages..."
    sudo apt upgrade -y
    if [ $? -eq 0 ]; then
        echo "âœ… Installed updates successfully on $distro."
    else
        echo "âŒ Failed to update packages on $distro. Exit code: $?"
    fi
}

dist_upgrade() {
    echo "ðŸ“¦ Upgrading distribution and dependencies..."
    sudo apt dist-upgrade -y
    if [ $? -eq 0 ]; then
        echo "âœ… Upgraded distribution successfully."
    else
        echo "âŒ Failed to upgrade $distro. Exit code: $?"
    fi
}

apt_autorm() {
    echo "ðŸ§¹ Removing unnecessary packages..."
    sudo apt autoremove -y
    if [ $? -eq 0 ]; then
        echo "âœ… Autoremove completed successfully on $distro."
    else
        echo "âŒ Autoremove failed on $distro. Exit code: $?"
    fi
}

apt_autocls() {
    echo "ðŸ§¼ Cleaning up local repository..."
    sudo apt autoclean -y
    if [ $? -eq 0 ]; then
        echo "âœ… Autoclean completed successfully on $distro."
    else
        echo "âŒ Autoclean failed on $distro. Exit code: $?"
    fi
}

install_package() {
    local package="$1"
    echo
    echo "ðŸ“¦ Installing package: $package"
    sudo apt install -y "$package"
    if [ $? -eq 0 ]; then
	echo "âœ… $package installed successfully!"
    else
	echo "âŒ Failed to install $package."
    fi
}

remove_package() {
    local package="$1"
    echo
    echo "ðŸ“¦ Removing package: $package"
    sudo apt remove -y "$package"
    if [ $? -eq 0 ]; then
        echo "âœ… $package removed successfully!"
    else
        echo "âŒ Failed to remove $package."
    fi
}

purge_package() {
    local package="$1"
    echo
    echo "ðŸ“¦ Purging package: $package"
    sudo apt purge -y "$package"
    if [ $? -eq 0 ]; then
        echo "âœ… $package purged successfully!"
    else
        echo "âŒ Failed to purge $package."
    fi
}

search_package() {
    local term="$1"
    echo "ðŸ” Searching for: $term"
    apt search "$term"
}


full_upgrade() {
    echo "âš™  Running full upgrade...!"
    apt_update && \
    apt_upgrade && \
    apt_autorm && \
    apt_autocls && \
    if [ $? -eq 0 ]; then
	echo "âœ… Full upgrade completed successfully!"
    else
	echo "âŒ An error occurred during the upgrade. Exit code: $?"
    fi
}

check_installed() {
    if command -v "$1" &> /dev/null; then
        return 0
    else
	return 1
    fi
}

ansible_deploy() {
    check_installed "ansible" || exit 1

    echo
    echo "Welcome to the AFM - Ansible Fast Management"
    echo "What would you like to do?"
    echo
    echo "[1] Run Playbook (with Flags)"
    echo "[2] Test Connection (Ping Hosts)"
    echo "[3] View Inventory"
    echo "[4] View Last Run Log"
    echo "[5] Exit"
    echo

    read -r option

    if printf -- '%d' "${option}" > /dev/null 2>&1; then
	case "${option}" in
	    1)
		echo "1 test"
		;;
	    2)
		echo "2 was selected"
		;;
	    3)
		mapfile -t playbooks < <(find . -type f -name "*.yml")
		loop=0
		for playbook in "${playbooks[@]}"; do
		    ((loop++))
		    dir_path=$(dirname "$playbook")
		    file_name=$(basename "$playbook")
		    printf '[%d] %s\n%s\n\n' "$loop" "$dir_path" "$file_name"
		done
	        ;;
	    4)
                log_file="/var/log/ansible.log"

		if [ -f "$log_file" ]; then
		    echo "ðŸ“„ Showing Ansible log: $log_file"
		    tail -n 50 "$log_file"
            	else
                    echo "âš ï¸  No Ansible log found at $log_file"
            	fi
                ;;
	    5)
                ;;
	    *)
		echo "Unsupported option"
		;;
	esac
    else
	echo "Unsupported option"
    fi
}

main() {
    show_banner
    det_release
    echo

	# Parse command-line flags
	case "$1" in
	    -aud|--apt-update)
		apt_update
		;;
	    -aur|--system-upgrade)
		apt_upgrade
		;;
	    -arm|--apt-autoremove)
		apt_autorm
		;;
	    -acl|--apt-autoclean)
		apt_autocls
		;;
	    -fu|--full-upgrade)
		full_upgrade
		;;
	    -dur|--dist-upgrade)
		dist_upgrade
		;;
	    -ai|--apt-install)
		shift
		if [ $# -eq 0 ]; then
		    echo "âŒ No packages specified to install."
		    exit 1
		fi

		for package in "$@"; do
		    install_package "$package"
		done
		;;
	    -arp|--apt-remove)
		shift
		if [ $# -eq 0 ]; then
		    echo "âŒ No packages specified to remove."
                    exit 1
		fi

		for package in "$@"; do
		    remove_package "$package"
		done
		;;
	    -ap|--apt-purge)
                shift
                if [ $# -eq 0 ]; then
                    echo "âŒ No packages specified to purge."
                    exit 1
                fi

                for package in "$@"; do
                    purge_package "$package"
                done
                ;;
	    -as|--apt-search)
		shift
		if [ $# -eq 0 ]; then
		    echo "âŒ No packages specified to search."
		    exit 1
		fi

		for term in "$@"; do
		    search_package "$term"
		done
		;;
	    -A|--ansible)
		ansible_deploy
		;;
	    -h|--help)
		echo
		echo "Usage: robohelp [option]"
		echo "	-aud, --apt-update	[1] Update APT Repositories"
		echo "	-aur, --apt-upgrade 	[1] Upgrade installed packages"
		echo "	-arm, --apt-autoremove  [1] Remove unnecessary packages"
		echo "	-acl, --apt-autoclean	[1] Clean up local repository"
		echo "	-fu,  --full-upgrade	Run full system upgrade with options from [1]"
		echo
		echo "	-dur, --dist-upgrade	Run distribution update for system"
		echo
		echo "	-ai,  --apt-install 	<name>	Install package via apt"
		echo "	-as,  --apt-search 	<name>	Search package in repository"
		echo " 	-arp, --apt-remove	<name>	Remove package from system"
		echo "	-ap,  --apt-purge	<name>	Remove package with all its dependencies"
		echo
		echo "	-A,   --ansible		Ansible Management"
		echo "	-h,   --help		Show this help message"
		;;
	    *)
		echo
		echo "Unknown or no flag provided. Try -h for help."
		;;
	esac
}

# Call the main function
main "$@"
